#!/bin/bash

# === Configuration ===
OTD_CONFIG_DIR="$HOME/.config/OpenTabletDriver"
PRESETS_DIR="$OTD_CONFIG_DIR/Presets"
MAIN_CONFIG="$OTD_CONFIG_DIR/config.json"
OTD_PID=$(pgrep -f "OpenTabletDriver")

# === Functions ===
list_presets() {
	echo "Available presets::"
	ls "$PRESETS_DIR" | grep '\.json$' | nl
}

switch_preset() {
	presets=($(ls "$PRESETS_DIR"/*.json))
	preset="${presets[$1 - 1]}"

	if [ -z "$preset" ]; then
		echo "Invalid selection."
		exit 1
	fi

	echo "Switching to preset: $(basename "$preset")"
	cp "$preset" "$MAIN_CONFIG"

	# Kill and restart OpenTabletDriver if running
	if [ -n "$OTD_PID" ]; then
		echo "Stopping OpenTabletDriver..."
		kill "$OTD_PID"
		sleep 2
	fi

	echo "Starting OpenTabletDriver..."
	nohup OpenTabletDriver &>/dev/null &
	echo "Done."
}

# === Script Execution ===
list_presets
echo -n "Enter the number of the preset to switch to: "
read -r choice

if [[ "$choice" =~ ^[0-9]+$ ]]; then
	switch_preset "$choice"
else
	echo "Invalid input."
fi
